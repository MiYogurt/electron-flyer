<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å®‰è£…ä¾èµ– | ç ´æ™“ï¼šé»‘å¤œä¹‹ä¸­çš„ Electron é£è¡ŒæŒ‡å—</title>
    <meta name="description" content="ğŸ¨ Electron æ²¡é‚£ä¹ˆéš¾">
    
    
    <link rel="preload" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css" as="style"><link rel="preload" href="/electron-flyer/assets/js/app.37dc6e8c.js" as="script"><link rel="preload" href="/electron-flyer/assets/js/9.b7ab19cb.js" as="script"><link rel="prefetch" href="/electron-flyer/assets/js/10.d6a7e726.js"><link rel="prefetch" href="/electron-flyer/assets/js/11.887eb323.js"><link rel="prefetch" href="/electron-flyer/assets/js/12.91b28bd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/13.2a080c63.js"><link rel="prefetch" href="/electron-flyer/assets/js/14.e6db4937.js"><link rel="prefetch" href="/electron-flyer/assets/js/15.4888b394.js"><link rel="prefetch" href="/electron-flyer/assets/js/16.6209dfc4.js"><link rel="prefetch" href="/electron-flyer/assets/js/17.4dabdbda.js"><link rel="prefetch" href="/electron-flyer/assets/js/18.d91d10ee.js"><link rel="prefetch" href="/electron-flyer/assets/js/19.2288f168.js"><link rel="prefetch" href="/electron-flyer/assets/js/2.6cf72073.js"><link rel="prefetch" href="/electron-flyer/assets/js/20.1d66ae28.js"><link rel="prefetch" href="/electron-flyer/assets/js/21.1073c24e.js"><link rel="prefetch" href="/electron-flyer/assets/js/22.9864bcb1.js"><link rel="prefetch" href="/electron-flyer/assets/js/23.0099ea93.js"><link rel="prefetch" href="/electron-flyer/assets/js/24.2924e65e.js"><link rel="prefetch" href="/electron-flyer/assets/js/25.9ffdaddc.js"><link rel="prefetch" href="/electron-flyer/assets/js/26.549bcbd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/3.7de79766.js"><link rel="prefetch" href="/electron-flyer/assets/js/4.e4c889ba.js"><link rel="prefetch" href="/electron-flyer/assets/js/5.968ec6b8.js"><link rel="prefetch" href="/electron-flyer/assets/js/6.0f1acbba.js"><link rel="prefetch" href="/electron-flyer/assets/js/7.08f680e1.js"><link rel="prefetch" href="/electron-flyer/assets/js/8.01be9bf3.js">
    <link rel="stylesheet" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme__container sidebar-open"><div class="row"><div class="col-md-2"><div class="sidebar"><div class="group"><div class="group__title">ç« èŠ‚å†…å®¹</div> <div class="group__body"><!---->  <div name="1.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/1.html">å†å²ä»‹ç»</a></div> </div><div name="2.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/2.html">å¼€å‘ç¯å¢ƒ</a></div> </div><div name="3.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/3.html">ä»£ç å°è£…</a></div> </div><div name="4.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/4.html">å‡½æ•°å¼</a></div> </div><div name="5.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/5.html">è·å–å°è¯´å‘½ä»¤è¡Œç‰ˆï¼ˆä¸Šï¼‰</a></div> </div><div name="6.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/6.html">è·å–å°è¯´å‘½ä»¤è¡Œç‰ˆï¼ˆä¸­ï¼‰</a></div> </div><div name="7.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/7.html">è·å–å°è¯´å‘½ä»¤è¡Œç‰ˆï¼ˆä¸‹ï¼‰</a></div> </div><div name="8.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/8.html">åµŒå…¥åˆ°åº”ç”¨ä¸­</a></div> </div><div name="9.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/9.html">æ’ä»¶æœºåˆ¶</a></div> </div><div name="10.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/10.html">æ–‡å­—è½¬è¯­éŸ³</a></div> </div><div name="11.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/11.html">è®¾ç½®ä¸ä¿¡å·ä¸­æ–­</a></div> </div><div name="12.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/12.html">æ’ä»¶å•†åº—</a></div> </div><div name="13.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/13.html">ä¸‹è½½ä¸åˆ é™¤ï¼ˆä¸Šï¼‰</a></div> </div><div name="14.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/14.html">ä¸‹è½½ä¸åˆ é™¤ï¼ˆä¸‹ï¼‰</a></div> </div><div name="15.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/15.html" class="router-link-exact-active router-link-active">é€šçŸ¥æ ç¨‹åº</a></div> </div><div name="16.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/16.html">æ’­æ”¾åŠŸèƒ½</a></div> </div><div name="17.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/17.html">ç¾åŒ–ç•Œé¢</a></div> </div><div name="18.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/18.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸Šï¼‰</a></div> </div><div name="19.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/19.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸­ï¼‰</a></div> </div><div name="20.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/20.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸‹ï¼‰</a></div> </div><div name="21.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/21.html">åµŒå…¥åˆ°åº”ç”¨ä¸­</a></div> </div><div name="22.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/22.html">æ‰“åŒ…åº”ç”¨</a></div> </div></div></div></div></div> <div class="col-md-10"><div class="page__container"><div class="content custom"><p>è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬çš„ç¨‹åºæ”¹é€ æˆé€šçŸ¥æ ç¨‹åºã€‚</p> <h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" aria-hidden="true" class="header-anchor">#</a> å®‰è£…ä¾èµ–</h2> <p>å…¶å®é€šçŸ¥æ çš„ç¨‹åºå°±æ˜¯å»æ‰çª—å£çš„è¾¹æ¡†ï¼Œç„¶åå®šä½åˆ°é€šçŸ¥æ å°å›¾æ ‡çš„ä¸‹é¢ï¼Œé€šçŸ¥æ æ˜¯å¯ä»¥è·å¾—å®ƒçš„ä½ç½®åæ ‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºè¿™ä¸ªåæ ‡è¿›è¡Œè®¡ç®—æ¥è·å¾—ã€‚è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://www.npmjs.com/package/electron-positioner" target="_blank" rel="noopener noreferrer">electron-positioner<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œè®¡ç®—ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒ <a href="https://github.com/maxogden/menubar/blob/master/index.js" target="_blank" rel="noopener noreferrer">menubar<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> é¡¹ç›®è¿›è¡Œæ”¹é€ ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>npm install electron-positioner --save
</code></pre></div><p>åˆ«å¿˜è®°è‡ªå·±æ·»åŠ ä¸€ä¸‹å®šä¹‰æ–‡ä»¶ï¼Œ<code>electron-positioner.d.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'electron-positioner'</span>
</code></pre></div><h2 id="ä¿®æ”¹-tray-ts"><a href="#ä¿®æ”¹-tray-ts" aria-hidden="true" class="header-anchor">#</a> ä¿®æ”¹ tray.ts</h2> <p>ç”±äºæˆ‘ä»¬éœ€è¦æ§åˆ¶é¡ºåºï¼Œ<code>ready</code> é‡Œé¢çš„é¡ºåºåˆ†å¼€æ¥çœ‹ä¸æ˜¯ç‰¹åˆ«æ˜æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æå–åˆ° <code>index.ts</code> ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ Tray å°å›¾æ ‡çš„ä¸€äº›å•å‡»ï¼ŒåŒå‡»ï¼Œå³é”®çš„äº‹ä»¶ï¼Œå½“è®¡ç®—çš„è·ç¦»æ˜¯ <code>tray</code> å¼€å¤´çš„æ—¶å€™ï¼Œéœ€è¦ä¼ å…¥ <code>tray.getBounds()</code> è·å–çš„å°å›¾æ ‡åæ ‡ç‚¹ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Positioner <span class="token keyword">from</span> <span class="token string">'electron-positioner'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> opensetting <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./tray'</span>

<span class="token keyword">let</span> tray<span class="token punctuation">:</span> Tray
<span class="token keyword">let</span> positioner<span class="token punctuation">:</span> <span class="token builtin">any</span>

<span class="token keyword">function</span> <span class="token function">setPostion</span><span class="token punctuation">(</span><span class="token parameter">win<span class="token punctuation">:</span> BrowserWindow</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¾—åˆ°ä½ç½®</span>
  positioner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Positioner</span><span class="token punctuation">(</span>win<span class="token punctuation">)</span>
  positioner<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">'trayCenter'</span><span class="token punctuation">,</span> tray<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  win<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createTray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»ºé€šçŸ¥æ å›¾æ ‡</span>
  tray <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Tray</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'tray_w24h24.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> contextMenu <span class="token operator">=</span> Menu<span class="token punctuation">.</span><span class="token function">buildFromTemplate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> label<span class="token punctuation">:</span> <span class="token string">'è®¾ç½®'</span><span class="token punctuation">,</span> click<span class="token punctuation">:</span> opensetting <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token string">'é€€å‡º'</span><span class="token punctuation">,</span>
      role<span class="token punctuation">:</span> <span class="token string">'quit'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token function-variable function">toggle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ˜¾ç¤ºéšè—</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mainWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mainWindow<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> mainWindow<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    positioner<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token string">'trayCenter'</span><span class="token punctuation">,</span> tray<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    mainWindow<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> toggle<span class="token punctuation">)</span> <span class="token comment">// å•å‡»</span>
  tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'double-click'</span><span class="token punctuation">,</span> toggle<span class="token punctuation">)</span> <span class="token comment">// åŒå‡»</span>
  tray<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'right-click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// å³é”®èœå•</span>
    tray<span class="token punctuation">.</span><span class="token function">popUpContextMenu</span><span class="token punctuation">(</span>contextMenu<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  mainWindow <span class="token operator">=</span> <span class="token function">createMainWindow</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token number">560</span><span class="token punctuation">,</span>
    frame<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    transparent<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    show<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">createTray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setPostion</span><span class="token punctuation">(</span>mainWindow<span class="token punctuation">)</span>
  <span class="token function">pluginSetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">crawlSetUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="è§£å†³-a-æ ‡ç­¾çš„æ‹–æ‹½é—®é¢˜"><a href="#è§£å†³-a-æ ‡ç­¾çš„æ‹–æ‹½é—®é¢˜" aria-hidden="true" class="header-anchor">#</a> è§£å†³ a æ ‡ç­¾çš„æ‹–æ‹½é—®é¢˜</h2> <p>è¿™ä¸ªæ—¶å€™æœ‰ä¸€ä¸ªå° bug , æ‰€æœ‰çš„è·³è½¬æŒ‰é’®æ˜¯å¯æ‹–åŠ¨çš„ï¼Œæˆ‘ä»¬éœ€è¦é˜»æ­¢ä¸€ä¸‹é»˜è®¤äº‹ä»¶ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>refs<span class="token punctuation">.</span>link<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'dragstart'</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/electron-flyer/assets/img/tray.1453e55e.gif" alt="Tray"></p> <h2 id="æ·»åŠ çŠ¶æ€"><a href="#æ·»åŠ çŠ¶æ€" aria-hidden="true" class="header-anchor">#</a> æ·»åŠ çŠ¶æ€</h2> <p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçŠ¶æ€æ¥æ ‡è®°æ˜¯å¦å·²ç»å¼€å§‹äº†é˜Ÿåˆ—ã€‚ä»¥åŠæ·»åŠ ä¸€ä¸ªè­¦å‘Šçš„æ–¹æ³•ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Store</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  currentPage<span class="token punctuation">:</span> Main<span class="token punctuation">,</span>
  msg<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'success'</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  start<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token comment">// å¼€å§‹é˜Ÿåˆ—å¦</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">warring</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> timer <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  store<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    msg<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'warring'</span><span class="token punctuation">,</span>
      content
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span>resetMsg<span class="token punctuation">,</span> timer<span class="token punctuation">)</span> <span class="token comment">// è‡ªåŠ¨å…³é—­æ¶ˆæ¯</span>
<span class="token punctuation">}</span>

store<span class="token punctuation">.</span>warring <span class="token operator">=</span> <span class="token function">warring</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>
</code></pre></div><h2 id="ä¿®æ”¹-download-svelte"><a href="#ä¿®æ”¹-download-svelte" aria-hidden="true" class="header-anchor">#</a> ä¿®æ”¹ Download.svelte</h2> <p>æ·»åŠ æ¨¡æ¿é€»è¾‘ï¼Œè®¿é—®å…¨å±€çŠ¶æ€ï¼Œä»¥ $ å¼€å¤´ã€‚éœ€è¦ä¸€ä¸ª canvas æ¥ç”»è¿›åº¦æ¡†ã€‚åŒ…è£¹ä¸€å±‚æ˜¯ä¸ºäº†å±…ä¸­ï¼Œä¸€å®šè¦åœ¨å±æ€§ä¸Šé¢ç»™ç¡®å®šçš„å¤§å°ï¼Œè¦ä¸ç„¶ä¼šç”»å‡ºæ¥çš„ä¸œè¥¿å°±çœ‹ä¸åˆ°äº†ã€‚å¯¹äº canvas æˆ‘ä¹Ÿæœ‰å½•åˆ¶è¿‡è§†å±ï¼Œ<a href="https://nodelover.me/course/canvas" target="_blank" rel="noopener noreferrer">åœ¨è¿™é‡Œ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ï¼Œä¸è¿‡ä¸æ˜¯å…è´¹çš„å†…å®¹ã€‚</p> <p><code>canvas</code> ä¸€å®šè¦é€šè¿‡ css æ§åˆ¶æ˜¾éšï¼Œè¦ä¸ç„¶ä¼šå¾ˆéš¾æ“ä½œï¼ŒåŠ¨æ€æŒ‚è½½ç”Ÿå‘½å‘¨æœŸæå…¶éš¾æ§åˆ¶ã€‚</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Back</span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {#if !$start}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>æ–‡ä»¶å<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span>folderName</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>çˆ¬å–ç½‘å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name"><span class="token namespace">bind:</span>value</span><span class="token attr-value"><span class="token punctuation">=</span>url</span> <span class="token punctuation">/&gt;</span></span>
    {/if}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>oprator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {#if !$start}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>download()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ä¸‹è½½<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        {:else}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>stop()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ä¸­æ–­<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        {/if}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

        {#if status.type }
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                {status.type == 'crawl' &amp;&amp; status.step == 'chapter' ?  'çˆ¬å–ç« èŠ‚': ''}
                {status.type == 'crawl' &amp;&amp; status.step == 'text'? 'çˆ¬å–å†…å®¹': ''}
                {status.type == 'audio'? 'è½¬æ¢éŸ³é¢‘': ''}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        {/if}

        {#if status.title}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                {status.title}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        {/if}

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>box {$start?'show':''}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name"><span class="token namespace">ref:</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>250<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>250<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>å®šä¹‰äº†é¢œè‰² <code>color</code> å®ƒä»£è¡¨æ¯ä¸€é˜¶æ®µè¿›åº¦æ¡çš„é¢œè‰²ï¼Œç„¶ååœ¨ oncreate çš„æ—¶å€™ï¼Œç»˜åˆ¶ canvasã€‚

è¿™é‡Œæˆ‘å¯¹æ‰€æœ‰çš„é”™è¯¯ç›¸å…³çš„è¿›è¡Œäº†é‡æ„ï¼Œé”™è¯¯æ¶ˆæ¯éƒ½æ˜¯ <code>type: 'error'</code> çš„ç»“æ„ã€‚å½“ä¸­æ­¢é˜Ÿåˆ—çš„æ—¶å€™ä¸è¦å¿˜è®°æ¸…ç©ºçŠ¶æ€ã€‚<code>once</code> æ˜¯ç”¨æ¥æ§åˆ¶æ¶ˆæ¯æç¤ºåªè°ƒç”¨ä¸€æ¬¡ï¼Œè°ƒç”¨å¤šæ¬¡ä¼šå‡ºç° Bugï¼Œæš‚æ—¶æ— æ³•æ‰¾åˆ°ä½•å¤„å‡ºäº†é—®é¢˜ï¼ŒçŒœæµ‹æ˜¯å†…ç½®åŠ¨ç”»çš„åŸå› ã€‚</p> <p>å¯¹äºç»˜åˆ¶è¿›åº¦æ¡ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªåœ†ï¼Œé€šè¿‡ <code>arc</code> <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/arc" target="_blank" rel="noopener noreferrer">API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> è¿›è¡Œäº†ç»˜åˆ¶ï¼Œç„¶åé€šè¿‡ <code>requestAnimationFrame</code> é€å¸§ç»˜åˆ¶ã€‚æ¯æ¬¡ç»˜åˆ¶éƒ½ä¼šå»çŠ¶æ€é‡Œé¢å–æœ€æ–°çš„å€¼ã€‚</p> <p>å¯¹äºç™¾åˆ†æ¯”å…¶å®å¾ˆç®€å•ï¼Œ<code>2 * PI / 100</code> å°±æ˜¯ç™¾åˆ†ä¹‹ä¸€ ï¼Œä¹˜ä»¥ç™¾åˆ†æ¯”å³å¯ã€‚ä¸ºäº†ä¿è¯ç”»å¸ƒçš„å¹²å‡€æ¯æ¬¡éƒ½éœ€è¦ <code>clearRect</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;electron&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token punctuation">:</span> <span class="token string">&quot;#00CC99&quot;</span><span class="token punctuation">,</span>
    audio<span class="token punctuation">:</span> <span class="token string">&quot;#3399CC&quot;</span><span class="token punctuation">,</span>
    stop<span class="token punctuation">:</span> <span class="token string">&quot;#FF3333&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        url<span class="token punctuation">:</span> <span class="token string">&quot;https://www.ybdu.com/xiaoshuo/0/910/&quot;</span><span class="token punctuation">,</span>
        folderName<span class="token punctuation">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
        status<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          type<span class="token punctuation">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
          title<span class="token punctuation">:</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">,</span>
          percent<span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      Back<span class="token punctuation">:</span> <span class="token string">&quot;../components/Back.svelte&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">oncreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> once <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;download-status&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// æ¥å—ä¸‹è½½çŠ¶æ€ï¼Œå¹¶æ¸²æŸ“åˆ° canvas</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token punctuation">(</span>args<span class="token punctuation">.</span>typw <span class="token operator">==</span> <span class="token string">&quot;audio&quot;</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>percent <span class="token operator">==</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">||</span>
          args<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;stop&quot;</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            status<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              type<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
              percent<span class="token punctuation">:</span> <span class="token number">0</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>once<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            once <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
          once <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">warring</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          status<span class="token punctuation">:</span> args
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          start<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token function-variable function">drawFrame</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>centerX <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>centerY <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">whiteCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">blueCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span> <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>drawFrame<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¯å¸§è‡ªåŠ¨æ¸²æŸ“</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token function">drawFrame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">ondestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ipcRenderer<span class="token punctuation">.</span><span class="token function">removeAllListeners</span><span class="token punctuation">(</span><span class="token string">&quot;download-status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> url<span class="token punctuation">,</span> folderName <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> folderName<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;download&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            url<span class="token punctuation">,</span>
            folderName
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> start<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;stop&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>centerX <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>centerY <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rad <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¿å­˜ä¹‹å‰çš„è½¬æ€ã€‚</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;#888&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">&quot;40px Arial&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>textAlign <span class="token operator">=</span> <span class="token string">&quot;center&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>textBaseline <span class="token operator">=</span> <span class="token string">&quot;middle&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span>percent <span class="token operator">+</span> <span class="token string">&quot;%&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>centerY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¢å¤ä¹‹å‰çš„è½¬æ€ã€‚</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">blueCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// ä¸Šå±‚è¿›åº¦å…¨</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> status <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> color<span class="token punctuation">[</span>status<span class="token punctuation">.</span>step<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&quot;#9900FF&quot;</span><span class="token punctuation">;</span> <span class="token comment">// ç»˜åˆ¶é¢œè‰²</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span> <span class="token comment">// ç»˜åˆ¶åœ†</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>centerX<span class="token punctuation">,</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>centerY<span class="token punctuation">,</span>
          <span class="token number">100</span><span class="token punctuation">,</span>
          <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> status<span class="token punctuation">.</span>percent <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>rad<span class="token punctuation">,</span>
          <span class="token boolean">false</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">whiteCircle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åº•å±‚ç™½åœˆ</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>strokeStyle <span class="token operator">=</span> <span class="token string">&quot;#383a41&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>centerX<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>centerY<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">stroke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">closePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="æ·»åŠ é‡è¯•ä¸ç­‰å¾…æœºåˆ¶"><a href="#æ·»åŠ é‡è¯•ä¸ç­‰å¾…æœºåˆ¶" aria-hidden="true" class="header-anchor">#</a> æ·»åŠ é‡è¯•ä¸ç­‰å¾…æœºåˆ¶</h2> <p>æœ‰çš„æ—¶å€™ä¼šæŠ¥ <code>getaddrinfo ENOTFOUND</code> é”™è¯¯ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªé‡è¯•çš„æœºåˆ¶ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> getMp3Data<span class="token punctuation">:</span> <span class="token function-variable function">any</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> opts<span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> textArr <span class="token operator">=</span> <span class="token function">splitText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
    textArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">text2audio</span><span class="token punctuation">(</span>chunk<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
      <span class="token keyword">return</span> data
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getMp3Data</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å†æ·»åŠ ä¸€ä¸ªç­‰å¾…æœºåˆ¶ï¼Œè‡ªè¡Œåˆ° <code>tray.ts</code> é‡Œé¢æ·»åŠ é…ç½®å“¦ï¼Œè¿™æ ·å¯ä»¥å‡å°ç½‘ç»œå‡ºé”™çš„æ¦‚ç‡ã€‚</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">await</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token constant">TTS_WAIT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="å¿½ç•¥é”™è¯¯"><a href="#å¿½ç•¥é”™è¯¯" aria-hidden="true" class="header-anchor">#</a> å¿½ç•¥é”™è¯¯</h2> <p>åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°  æ€»æ˜¯æœ‰çš„æ—¶å€™ä¼šé‡è§ <code>mp3-concat</code> æœ‰é”™è¯¯ï¼Œä¼šå¼¹å‡ºé€‰é¡¹æ¡†ï¼Œè¿™å°±å¾ˆä¸å‹å¥½ï¼Œä½†æ˜¯å®é™…å†…å®¹æ˜¯æ²¡æœ‰ä¸¢å¤±çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å¿½ç•¥æ‰å®ƒï¼Œä¿®æ”¹ <code>index.ts</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'unhandledRejection'</span><span class="token punctuation">,</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span> <span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
</code></pre></div><p><img src="/electron-flyer/assets/img/download_story.5eebfcb7.gif" alt="download"></p></div> <div class="content__footer-container"><div class="content__footer"><!----> <!----></div></div></div></div></div></div></div>
    <script src="/electron-flyer/assets/js/app.37dc6e8c.js" defer></script><script src="/electron-flyer/assets/js/9.b7ab19cb.js" defer></script>
  </body>
</html>
