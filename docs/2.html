<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>黑盒子 Electron | 破晓：黑夜之中的 Electron 飞行指南</title>
    <meta name="description" content="🎨 Electron 没那么难">
    
    
    <link rel="preload" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css" as="style"><link rel="preload" href="/electron-flyer/assets/js/app.22e63a91.js" as="script"><link rel="preload" href="/electron-flyer/assets/js/4.fa89f104.js" as="script"><link rel="prefetch" href="/electron-flyer/assets/js/10.d6a7e726.js"><link rel="prefetch" href="/electron-flyer/assets/js/11.887eb323.js"><link rel="prefetch" href="/electron-flyer/assets/js/12.91b28bd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/13.2a080c63.js"><link rel="prefetch" href="/electron-flyer/assets/js/14.e6db4937.js"><link rel="prefetch" href="/electron-flyer/assets/js/15.4888b394.js"><link rel="prefetch" href="/electron-flyer/assets/js/16.6209dfc4.js"><link rel="prefetch" href="/electron-flyer/assets/js/17.4dabdbda.js"><link rel="prefetch" href="/electron-flyer/assets/js/18.d91d10ee.js"><link rel="prefetch" href="/electron-flyer/assets/js/19.2288f168.js"><link rel="prefetch" href="/electron-flyer/assets/js/2.182ecb78.js"><link rel="prefetch" href="/electron-flyer/assets/js/20.1d66ae28.js"><link rel="prefetch" href="/electron-flyer/assets/js/21.1073c24e.js"><link rel="prefetch" href="/electron-flyer/assets/js/22.9864bcb1.js"><link rel="prefetch" href="/electron-flyer/assets/js/23.0099ea93.js"><link rel="prefetch" href="/electron-flyer/assets/js/24.2924e65e.js"><link rel="prefetch" href="/electron-flyer/assets/js/25.9ffdaddc.js"><link rel="prefetch" href="/electron-flyer/assets/js/26.549bcbd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/3.7de79766.js"><link rel="prefetch" href="/electron-flyer/assets/js/5.968ec6b8.js"><link rel="prefetch" href="/electron-flyer/assets/js/6.0f1acbba.js"><link rel="prefetch" href="/electron-flyer/assets/js/7.08f680e1.js"><link rel="prefetch" href="/electron-flyer/assets/js/8.01be9bf3.js"><link rel="prefetch" href="/electron-flyer/assets/js/9.b7ab19cb.js">
    <link rel="stylesheet" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme__container sidebar-open"><div class="row"><div class="col-md-2"><div class="sidebar"><div class="group"><div class="group__title">章节内容</div> <div class="group__body"><!---->  <div name="1.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/1.html">历史介绍</a></div> </div><div name="2.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/2.html" class="router-link-exact-active router-link-active">开发环境</a></div> </div><div name="3.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/3.html">代码封装</a></div> </div><div name="4.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/4.html">函数式</a></div> </div><div name="5.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/5.html">获取小说命令行版（上）</a></div> </div><div name="6.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/6.html">获取小说命令行版（中）</a></div> </div><div name="7.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/7.html">获取小说命令行版（下）</a></div> </div><div name="8.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/8.html">嵌入到应用中</a></div> </div><div name="9.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/9.html">插件机制</a></div> </div><div name="10.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/10.html">文字转语音</a></div> </div><div name="11.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/11.html">设置与信号中断</a></div> </div><div name="12.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/12.html">插件商店</a></div> </div><div name="13.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/13.html">下载与删除（上）</a></div> </div><div name="14.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/14.html">下载与删除（下）</a></div> </div><div name="15.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/15.html">通知栏程序</a></div> </div><div name="16.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/16.html">播放功能</a></div> </div><div name="17.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/17.html">美化界面</a></div> </div><div name="18.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/18.html">数据可视化（上）</a></div> </div><div name="19.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/19.html">数据可视化（中）</a></div> </div><div name="20.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/20.html">数据可视化（下）</a></div> </div><div name="21.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/21.html">嵌入到应用中</a></div> </div><div name="22.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/22.html">打包应用</a></div> </div></div></div></div></div> <div class="col-md-10"><div class="page__container"><div class="content custom"><h2 id="黑盒子-electron"><a href="#黑盒子-electron" aria-hidden="true" class="header-anchor">#</a> 黑盒子 Electron</h2> <p><a href="https://electronjs.org/" target="_blank" rel="noopener noreferrer">Electron<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可以看做是包含 Node 和 Chromium 黑盒的程序启动器，在官网有这样一段代码。</p> <div class="language-sh extra-class"><pre class="language-text"><code>$ npm i -D electron@latest
# Electron   2.0.4
# Node       8.9.3
# Chromium   61.0.3163.100
</code></pre></div><p>当我们安装好了一个 electron 程序，它自身会有一个版本号，同时包含了 Node 环境与 Chromium 浏览器环境，我们再来看一下安装好的依赖是怎么样的。</p> <p><img src="/electron-flyer/assets/img/electron-bin.37cb7898.png" alt="electron-bin"></p> <p>当我们运行 electron 的时候，它运行的其实是这个二进制文件，就像运行 node 一样，运行的时候，我们会指定一个 index.js 文件作为入口点，在这个入口点里面创建窗口，操作本地系统等等。这也是为什么我说它是一个黑盒。</p> <p>当然运行这个二进制，不是把它加入到 PATH 环境里面，而是通过 Node 的 <code>child_process</code> 呼起一个进程。这个 <code>Electron.app</code> 文件，在 Mac 下面是可以直接运行的，下面就是运行的结果。</p> <p><img src="/electron-flyer/assets/img/electron-empty.0126604d.png" alt="electron-empty"></p> <h2 id="必知的进程概念"><a href="#必知的进程概念" aria-hidden="true" class="header-anchor">#</a> 必知的进程概念</h2> <p>当我们开发一个本地应用的时候，免不了的就要访问本地的文件，浏览器很明显不具备这样的功能。同时还要有访问网络的能力，或许 Node 可以胜任，因为它可以访问文件和访问网络，那么用户交互界面怎么办呢？普通用户会愿意去面对一个控制台么？于是乎，为啥不把浏览器和 Node 结合起来，浏览器负责显示界面，Node 负责访问网络和其他的这不就好了么。</p> <p>是的，没错，就这样 Electron 诞生了，但是这里面有非常多的工作，比如环境的整合，执行的架构等等。在前面提到交互界面与访问本地文件与网络两个功能，在 Electron 中，就刚好有两个进程相互对应，有点类似于前端框架的服务端渲染，也有是说它有两个运行环境。</p> <p><img src="/electron-flyer/assets/img/electron_2process.f7066159.png" alt="electron_2process"></p> <p>但是呢，在渲染进程里面，还是可以访问本地文件模块的，也就是说 Node 的 API 是交融在一起的，两个进程之间通过 ipc 进行通行，官方封装好了对应的模块。通信代码会与下面的代码类似。</p> <p><strong>在主进程中</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ipcMain <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token comment">// 异步返回</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'asynchronous-message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'asynchronous-reply'</span><span class="token punctuation">,</span> <span class="token string">'pong'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 同步返回 -&gt; 会阻塞渲染进程</span>
ipcMain<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'synchronous-message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token string">'pong'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>在渲染进程中</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> ipcRenderer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'electron'</span><span class="token punctuation">)</span>
<span class="token comment">// 同步接收</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ipcRenderer<span class="token punctuation">.</span><span class="token function">sendSync</span><span class="token punctuation">(</span><span class="token string">'synchronous-message'</span><span class="token punctuation">,</span> <span class="token string">'ping'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 异步接收</span>
ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'asynchronous-reply'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="开发环境的更新与重启"><a href="#开发环境的更新与重启" aria-hidden="true" class="header-anchor">#</a> 开发环境的更新与重启</h2> <p>Electron 程序中，对于渲染进程实现热替换跟浏览器其实是一样的，当我们新建了一个窗口的时候，在生产环境的时候可能是载入一个 html 文件，当在开发环境的时候则是载入一段 http 协议的网址，当更新了的时候通过 websocket 通知页面刷新即可。</p> <p>而对于主进程则没有热更新，只能把进程杀死再重启，等会我会讲解 electron-vue 脚手架的核心原理。</p> <h2 id="我自己的解决方案"><a href="#我自己的解决方案" aria-hidden="true" class="header-anchor">#</a> 我自己的解决方案</h2> <p>在我写的<a href="https://github.com/MiYogurt/mmmmh" target="_blank" rel="noopener noreferrer">图片压缩应用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，使用了 <code>chokidar</code> 和一段脚本实现了热重启。在启动脚本中有这样一段 <code>scripts</code> 命令</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;chokidar './src/*.js' -c './scripts/dev.sh' --initial&quot;</span>
</code></pre></div><p>启动脚本为</p> <div class="language-shell extra-class"><pre class="language-text"><code>#!/usr/bin/env bash

function check(){
  count=`ps -ef |grep $1 |grep -v &quot;grep&quot; |wc -l`

  if [ 0 -ne $count ];then
    echo &quot;Kill Electron&quot;
    killall $1
  fi
}

check &quot;Electron&quot; &amp;&amp; yarn start
</code></pre></div><p>这样的方式虽然可以很简单，但是会误杀掉所有的 Electron 程序，通过下面的方式杀死进程可能会更好一些。</p> <div class="language-sh extra-class"><pre class="language-text"><code>pkill -f project_name
</code></pre></div><h2 id="electron-vue-的解决方案"><a href="#electron-vue-的解决方案" aria-hidden="true" class="header-anchor">#</a> electron-vue 的解决方案</h2> <p>其他类的脚手架也是类似的原理，通过编程的方式，操作 <code>process</code> 来杀死进程。首先打开 <a href="https://github.com/SimulatedGREG/electron-vue/blob/4c6ee7bf4f9b4aa647a22ec1c1ca29c2e59c3645/template/.electron-vue/dev-runner.js" target="_blank" rel="noopener noreferrer">dev-runner.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 文件，关于打包的事，我就不多说了，做这种打包方案难倒是不难，参考非常多，就是查 Webpack API 比较麻烦，需要花不少时间，特别是做服务端渲染配置的时候也是这样，</p> <p><code>startRenderer</code> 函数，载入了渲染进程 webpack 配置，通过 <code>WebpackDevServer</code> 监听了 <code>9080</code>端口，而 <code>startMain</code> 函数里面有这样一段。它监听了主线程文件修改，当修改通过 <code>process.kill</code> 杀死，并调用 <code>startElectron</code> 重启，并且有一个 <code>manualRestart</code> 标志位避免频繁重启，</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>compiler<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token function">logStats</span><span class="token punctuation">(</span><span class="token string">'Main'</span><span class="token punctuation">,</span> stats<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>electronProcess <span class="token operator">&amp;&amp;</span> electronProcess<span class="token punctuation">.</span>kill<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    manualRestart <span class="token operator">=</span> <span class="token boolean">true</span>
    process<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span>electronProcess<span class="token punctuation">.</span>pid<span class="token punctuation">)</span>
    electronProcess <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token function">startElectron</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      manualRestart <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在 <code>startElectron</code> 中通过子进程启动 electron 程序、</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">startElectron</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  electronProcess <span class="token operator">=</span> <span class="token function">spawn</span><span class="token punctuation">(</span>electron<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'--inspect=5858'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  electronProcess<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">electronLog</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  electronProcess<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">electronLog</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  electronProcess<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>manualRestart<span class="token punctuation">)</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="electronforge"><a href="#electronforge" aria-hidden="true" class="header-anchor">#</a> electronforge</h2> <p><a href="https://electronforge.io/" target="_blank" rel="noopener noreferrer">electronforge<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 提供了一体化的 electron 开发体验，从 node 版本替换到打包，自动上传等等，是非常方便的，但是呢，本教程不会用这个脚手架，基于两点考虑。</p> <ul><li><p>v6 版本尚未发布，一直处于 beta 阶段，估计要等 electron3</p></li> <li><p>封装的太高了，反而啥都学不到了，我会尽量使用偏底层的各种包，让大家接触更多技术点。</p></li></ul> <h2 id="electron-webpack"><a href="#electron-webpack" aria-hidden="true" class="header-anchor">#</a> electron-webpack</h2> <p>这将会是我们使用的开发脚手架，我会以添加 svelte 框架为例，教大家自定义 webpack 配置。它的原理其实就是上面 electron-vue 所提到的那样，不过它的 config 载入的逻辑要多很多。阅读 <a href="https://webpack.electron.build/" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 获取更多帮助信息。</p> <p>现在我们来初始化我们的脚手架。</p> <div class="language-shell extra-class"><pre class="language-text"><code>git clone https://github.com/electron-userland/electron-webpack-quick-start.git reading-app
cd reading-app
rm -rf .git
npm install
</code></pre></div><p>为了使下载速度更快，我们可以使用国内的镜像。对于 zsh 或者 bash ，设置 <code>ELECTRON_MIRROR</code> 环境变量即可</p> <div class="language-sh extra-class"><pre class="language-text"><code>export ELECTRON_MIRROR=https://npm.taobao.org/mirrors/electron/
</code></pre></div><p>fish 使用</p> <div class="language-sh extra-class"><pre class="language-text"><code>set -x ELECTRON_MIRROR https://npm.taobao.org/mirrors/electron/
</code></pre></div><h2 id="安装依赖"><a href="#安装依赖" aria-hidden="true" class="header-anchor">#</a> 安装依赖</h2> <p>要使用 webpack 构建 svelte ，首先要安装它的依赖，由于 svelte 是编译型的框架，所以安装到开发依赖即可。</p> <div class="language-sh extra-class"><pre class="language-text"><code>npm install svelte svelte-loader --save-dev
</code></pre></div><p>然后我们开始自定义渲染进程的 webpack 配置，我们需要参考一下 <a href="https://webpack.electron.build/modifying-webpack-configurations" target="_blank" rel="noopener noreferrer">electron-webpack 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://github.com/sveltejs/template-webpack/blob/master/webpack.config.js" target="_blank" rel="noopener noreferrer">svelte 官网模板配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 假如你完全按照它的来，你得到的错误会莫名奇妙，不信你可以尝试一下，假如你的对调试不熟悉一些的话，可能你永远也不会知道它问题出在哪。</p> <p>首先修改 <code>package.json</code></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;electronWebpack&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;renderer&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;webpackConfig&quot;</span><span class="token operator">:</span> <span class="token string">&quot;conf/webpack.renderer.additions.js&quot;</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>然后创建该文件，配置如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.svelte'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    mainFields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'svelte'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.svelte$/</span><span class="token punctuation">,</span>
        exclude<span class="token punctuation">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'svelte-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            skipIntroByDefault<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            nestedTransitions<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            emitCss<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            hotReload<span class="token punctuation">:</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>不要配置 css，因为会造成重复，所以才导致莫名奇妙的问题，配置 <code>mainFields</code> 是为了假如你想导入 <code>svelte</code> 组件，可以被识别。</p> <p>不使用 html 后缀是为了避免冲突，要不然 js 代码会被当做字符串载入。</p> <h2 id="添加渲染进程内容"><a href="#添加渲染进程内容" aria-hidden="true" class="header-anchor">#</a> 添加渲染进程内容</h2> <p>关于 Svelte 可以查看<a href="https://svelte.technology/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，我<a href="https://nodelover.me/course/svelte-introduction-guide" target="_blank" rel="noopener noreferrer">录制的视频<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可能有些老了</p> <p>修改 <code>renderer/index.js</code> 的内容</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.svelte'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  target<span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'world'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>新增 <code>renderer/App.svelte</code> 文件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello {name}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">h1</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="运行-app"><a href="#运行-app" aria-hidden="true" class="header-anchor">#</a> 运行 App</h2> <div class="language-sh extra-class"><pre class="language-text"><code>npm run dev
</code></pre></div><p><img src="/electron-flyer/assets/img/electron-svelte.1001e3a6.png" alt="electron-svelte"></p> <h2 id="学习-svelte-的方法"><a href="#学习-svelte-的方法" aria-hidden="true" class="header-anchor">#</a> 学习 Svelte 的方法</h2> <p>先看一遍它的 <a href="https://svelte.technology/repl?demo=hello-world" target="_blank" rel="noopener noreferrer">demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，然后看<a href="https://svelte.technology/guide#introduction" target="_blank" rel="noopener noreferrer">文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="content__footer-container"><div class="content__footer"><!----> <!----></div></div></div></div></div></div></div>
    <script src="/electron-flyer/assets/js/app.22e63a91.js" defer></script><script src="/electron-flyer/assets/js/4.fa89f104.js" defer></script>
  </body>
</html>
