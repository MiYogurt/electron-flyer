<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å®‰è£…ä¾èµ– | ç ´æ™“ï¼šé»‘å¤œä¹‹ä¸­çš„ Electron é£è¡ŒæŒ‡å—</title>
    <meta name="description" content="ğŸ¨ Electron æ²¡é‚£ä¹ˆéš¾">
    
    
    <link rel="preload" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css" as="style"><link rel="preload" href="/electron-flyer/assets/js/app.321478e2.js" as="script"><link rel="preload" href="/electron-flyer/assets/js/15.4888b394.js" as="script"><link rel="prefetch" href="/electron-flyer/assets/js/10.d6a7e726.js"><link rel="prefetch" href="/electron-flyer/assets/js/11.887eb323.js"><link rel="prefetch" href="/electron-flyer/assets/js/12.91b28bd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/13.2a080c63.js"><link rel="prefetch" href="/electron-flyer/assets/js/14.e6db4937.js"><link rel="prefetch" href="/electron-flyer/assets/js/16.6209dfc4.js"><link rel="prefetch" href="/electron-flyer/assets/js/17.4dabdbda.js"><link rel="prefetch" href="/electron-flyer/assets/js/18.d91d10ee.js"><link rel="prefetch" href="/electron-flyer/assets/js/19.2288f168.js"><link rel="prefetch" href="/electron-flyer/assets/js/2.6cf72073.js"><link rel="prefetch" href="/electron-flyer/assets/js/20.1d66ae28.js"><link rel="prefetch" href="/electron-flyer/assets/js/21.1073c24e.js"><link rel="prefetch" href="/electron-flyer/assets/js/22.9864bcb1.js"><link rel="prefetch" href="/electron-flyer/assets/js/23.0099ea93.js"><link rel="prefetch" href="/electron-flyer/assets/js/24.2924e65e.js"><link rel="prefetch" href="/electron-flyer/assets/js/25.9ffdaddc.js"><link rel="prefetch" href="/electron-flyer/assets/js/26.549bcbd0.js"><link rel="prefetch" href="/electron-flyer/assets/js/3.7de79766.js"><link rel="prefetch" href="/electron-flyer/assets/js/4.e4c889ba.js"><link rel="prefetch" href="/electron-flyer/assets/js/5.968ec6b8.js"><link rel="prefetch" href="/electron-flyer/assets/js/6.0f1acbba.js"><link rel="prefetch" href="/electron-flyer/assets/js/7.08f680e1.js"><link rel="prefetch" href="/electron-flyer/assets/js/8.01be9bf3.js"><link rel="prefetch" href="/electron-flyer/assets/js/9.b7ab19cb.js">
    <link rel="stylesheet" href="/electron-flyer/assets/css/0.styles.3d6eb61a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme__container sidebar-open"><div class="row"><div class="col-md-2"><div class="sidebar"><div class="group"><div class="group__title">ç« èŠ‚å†…å®¹</div> <div class="group__body"><!---->  <div name="1.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/1.html">åˆè¯† Electron</a></div> </div><div name="2.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/2.html">äº†è§£ Electron å¼€å‘ç¯å¢ƒ</a></div> </div><div name="3.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/3.html">å°è£…ï¼ˆä¸€ï¼‰</a></div> </div><div name="4.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/4.html">Typescript</a></div> </div><div name="5.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/5.html">è·å–å°è¯´å†…å®¹å‘½ä»¤è¡Œç¨‹åºç‰ˆï¼ˆä¸Šï¼‰</a></div> </div><div name="6.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/6.html">è·å–å°è¯´å†…å®¹å‘½ä»¤è¡Œç¨‹åºç‰ˆï¼ˆä¸­ï¼‰</a></div> </div><div name="7.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/7.html">è·å–å°è¯´å†…å®¹å‘½ä»¤è¡Œç¨‹åºç‰ˆï¼ˆä¸‹ï¼‰</a></div> </div><div name="8.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/8.html" class="router-link-exact-active router-link-active">åµŒå…¥åˆ°åº”ç”¨ä¸­</a></div> </div><div name="9.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/9.html">æ’ä»¶</a></div> </div><div name="10.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/10.html">æ–‡å­—è½¬è¯­éŸ³</a></div> </div><div name="11.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/11.html">è®¾ç½®ä¸ä¿¡å·ä¸­æ–­</a></div> </div><div name="12.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/12.html">æ’ä»¶å•†åº—</a></div> </div><div name="13.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/13.html">ä¸‹è½½ä¸åˆ é™¤ï¼ˆä¸Šï¼‰</a></div> </div><div name="14.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/14.html">ä¸‹è½½ä¸åˆ é™¤ï¼ˆä¸‹ï¼‰</a></div> </div><div name="15.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/15.html">é€šçŸ¥æ ç¨‹åº</a></div> </div><div name="16.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/16.html">æ’­æ”¾åŠŸèƒ½</a></div> </div><div name="17.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/17.html">ç¾åŒ–</a></div> </div><div name="18.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/18.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸Šï¼‰</a></div> </div><div name="19.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/19.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸­ï¼‰</a></div> </div><div name="20.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/20.html">æ•°æ®å¯è§†åŒ–ï¼ˆä¸‹ï¼‰</a></div> </div><div name="21.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/21.html">åµŒå…¥åˆ°åº”ç”¨ä¸­</a></div> </div><div name="22.html" class="group__category category"><div class="category__label"><a href="/electron-flyer/22.html">æ‰“åŒ…</a></div> </div></div></div></div></div> <div class="col-md-10"><div class="page__container"><div class="content custom"><p>è¿™ä¸€èŠ‚ï¼Œå…ˆå»æ‰ <code>url-join</code> ï¼Œåœ¨ <code>ts</code> ç¯å¢ƒä¸‹ï¼Œä¼¼ä¹æ²¡æ³•æŠŠ <code>require</code> ä¼ é€’è¿›å»ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æš‚æ—¶å…ˆæŠ›å¼ƒè¿™ä¸ªåŠŸèƒ½ã€‚</p> <h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" aria-hidden="true" class="header-anchor">#</a> å®‰è£…ä¾èµ–</h2> <div class="language- extra-class"><pre class="language-text"><code>npm install iconv-lite cheerio fs-extra --save
</code></pre></div><ul><li>iconv-lite æ˜¯è½¬ç  gbk å·¥å…·ï¼Œé¿å…ä¹±ç </li> <li>cheerio æ˜¯æœåŠ¡ç«¯çš„ jquery è§£æå™¨</li> <li>fs-extra æ–‡ä»¶å¢å¼ºæ¨¡å—</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm install @types/cheerio @types/iconv-lite @types/fs-extra --save-dev
</code></pre></div><p>TypeScript åªæœ‰åœ¨æœ‰å®šä¹‰æ–‡ä»¶çš„å‰æä¸‹ï¼Œæ‰èƒ½æä¾›ä»£ç æç¤ºã€‚</p> <ul><li>æ·»åŠ å®šä¹‰æ–‡ä»¶ <code>src/main/phin.d.ts</code></li></ul> <p>å¹¶éæ‰€æœ‰æ¨¡å—éƒ½æœ‰å®šä¹‰æ–‡ä»¶çš„ï¼Œæ²¡æœ‰å®šä¹‰æ–‡ä»¶å°±åªèƒ½è‡ªå·±å†™å®šä¹‰æ–‡ä»¶äº†ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>declare module 'phin' {
  export function promisified(url: string, opts?: any): Promise&lt;string&gt;
}
</code></pre></div><h2 id="å®šä¹‰æ¥å£"><a href="#å®šä¹‰æ¥å£" aria-hidden="true" class="header-anchor">#</a> å®šä¹‰æ¥å£</h2> <p>ä¸ºäº†ä½¿ç¨‹åºæ›´åŠ çš„ <code>TypeScript</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€äº›æ¥å£ï¼Œæ¥çº¦å®šå¼€å‘è§„èŒƒï¼Œæ–°å»º <code>src/main/crawl.ts</code></p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> app <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'electron'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">downloadOptions</span> <span class="token punctuation">{</span>
  <span class="token comment">// ä¸‹è½½é€‰é¡¹</span>
  path<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token comment">// ï¼Ÿ è¡¨ç¤ºå¯é€‰å±æ€§ï¼Œè·¯å¾„</span>
  concurrence<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token comment">// å¹¶å‘é‡</span>
  waitTime<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token comment">// ç­‰å¾…äº‹ä»¶</span>
  charset<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token comment">// å­—ç¬¦é›†</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> defaultOptions<span class="token punctuation">:</span> downloadOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// è®¾ç½®ä¸€ä¸ªé»˜è®¤å€¼</span>
  path<span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'xiaoshuo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  concurrence<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  waitTime<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
  charset<span class="token punctuation">:</span> <span class="token string">'utf-8'</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> defaultOptions <span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Chatper</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç« èŠ‚çš„æ•°æ®</span>
  title<span class="token punctuation">:</span> <span class="token builtin">string</span>
  url<span class="token punctuation">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Crawl</span> <span class="token punctuation">{</span>
  <span class="token comment">// çˆ¬å–è§„åˆ™éœ€è¦æä¾›çš„é€‰é¡¹</span>
  opts<span class="token operator">?</span><span class="token punctuation">:</span> downloadOptions <span class="token comment">// çˆ¬å–é€‰é¡¹ã€‚</span>
  <span class="token function">text</span><span class="token punctuation">(</span>select<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Chatper<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// ç« èŠ‚å†…å®¹çˆ¬å–è§„åˆ™</span>
  <span class="token function">chapter</span><span class="token punctuation">(</span>select<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">:</span> Chatper<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// çˆ¬å–ç« èŠ‚çš„è§„åˆ™</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ä¸ªæ–‡ä»¶é‡Œé¢çœŸæ­£æœ‰ä½œç”¨çš„åªæœ‰ <code>defaultOptions</code> ï¼Œ<code>interface</code> åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šè¢«åˆ é™¤æ‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™æ€ç±»å‹åªä¼šåœç•™å’‹ ts å±‚é¢ã€‚</p> <h2 id="çŠ¶æ€é€šä¿¡"><a href="#çŠ¶æ€é€šä¿¡" aria-hidden="true" class="header-anchor">#</a> çŠ¶æ€é€šä¿¡</h2> <p>ä¸ºäº†è®©ä¸‹è½½çŠ¶æ€å¯ä»¥ä¼ è¾“åˆ°æ¸²æŸ“è¿›ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º IPC é€šä¿¡çš„ä¿¡é“ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>Subject</code> å°è£…ä¸€ä¸‹ï¼Œ<code>Subject</code> çš„å®ä¾‹å¯ä»¥è°ƒç”¨ <code>next</code> æ–¹æ³•ï¼Œä¼ é€’è¿›å»çš„å‚æ•°ï¼Œä¼šåŸæ ·ä¼ é€’ç»™ <code>subscribe</code> é‡Œé¢çš„å›è°ƒã€‚ æ–°å»º <code>statusLog.ts</code> ã€‚</p> <blockquote><p>å°è£…æˆ subject æœ‰å•¥å¥½å¤„ï¼Ÿ</p> <p>å•ä¸ªæ¥çœ‹ï¼Œå…¶å®æ²¡å•¥å¥½å¤„ã€‚åªä¸è¿‡æ¯”è¾ƒ Rxjsï¼Œå®¹æ˜“è·Ÿå…¶ä»–æ“ä½œç¬¦ç»“åˆã€‚</p></blockquote> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> mainWindow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span>

<span class="token keyword">interface</span> <span class="token class-name">Log</span> <span class="token punctuation">{</span>
  <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token comment">// ç±»å‹</span>
  step<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token comment">// ç¬¬å‡ æ­¥</span>
  percent<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">number</span> <span class="token comment">// ç™¾åˆ†æ¯”</span>
  message<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token comment">// æ¶ˆæ¯</span>
  <span class="token punctuation">[</span>index<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token builtin">any</span> <span class="token comment">// å…¶ä»–å±æ€§ï¼Œåªè¦å±æ€§åä¸º string ç±»å‹ï¼Œå€¼ä¸º any ä»»æ„ç±»å‹éƒ½å¯ä»¥</span>
<span class="token punctuation">}</span>

<span class="token comment">// å‘é€çŠ¶æ€æ˜¾ç¤ºç»™ç”¨æˆ·</span>
<span class="token keyword">const</span> <span class="token function-variable function">createLog</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> log$ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span>Log<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  log$<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>
    <span class="token parameter">log</span> <span class="token operator">=&gt;</span> mainWindow <span class="token operator">&amp;&amp;</span> mainWindow<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'download-status'</span><span class="token punctuation">,</span> log<span class="token punctuation">)</span> <span class="token comment">// ä¸»çº¿ç¨‹å‘é€åˆ°æ¸²æŸ“è¿›ç¨‹é€šè¿‡ webContents ä¸Šä¸‹æ–‡å‘é€ã€‚</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">return</span> log$<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>log$<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// (log: Log) =&gt; void è¡¨ç¤ºåŒ¿åå‡½æ•°çš„ç±»å‹ï¼Œ void è¡¨ç¤ºç©º</span>
<span class="token keyword">const</span> <span class="token function-variable function">log</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token parameter">log<span class="token punctuation">:</span> Log</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span> <span class="token operator">=</span> <span class="token function">createLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> log
</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸‹é€šä¿¡çš„æ ¼å¼æ¥å£ï¼Œä¼ é€’ä¿¡æ¯ç»™æ¸²æŸ“è¿›ç¨‹ï¼Œå¿…é¡»è¦æ‹¿åˆ°çª—å£å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <code>index.ts</code> é‡Œé¢å¯¼å‡ºä¸€ä¸‹è¿™ä¸ªå®ä¾‹ã€‚è¿™é‡Œä¸€å®šè¦ç»‘å®šä¸€ä¸‹ <code>this</code> çš„æŒ‡å‘ï¼Œè¦ä¸ç„¶ä¼šæŠ¥é”™ã€‚</p> <h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" aria-hidden="true" class="header-anchor">#</a> ä¸‹è½½</h2> <p>ç°åœ¨æˆ‘ä»¬å°†ä¸Šä¸€èŠ‚çš„å†…å®¹æ”¹æˆ <code>TypeScript</code> çš„ç‰ˆæœ¬ï¼Œä¸€äº›æ£€æµ‹å‡½æ•°æˆ‘ç”¨ <code>fs-extra</code> è¿›è¡Œäº†ä»£æ›¿ï¼Œè¿™æ ·çœ‹èµ·æ¥ä¼šæ›´ç®€æ´äº›ã€‚</p> <ul><li>å¯¼å…¥ä¾èµ–ä¸æ¥å£</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> promisified <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'phin'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ServerRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'http'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> decode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'iconv-lite'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> load <span class="token keyword">as</span> cheerio <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cheerio'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> writeJSON<span class="token punctuation">,</span> ensureDir<span class="token punctuation">,</span> readJson <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs-extra'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token keyword">of</span><span class="token punctuation">,</span> timer<span class="token punctuation">,</span> throwError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pluck<span class="token punctuation">,</span> map<span class="token punctuation">,</span> concatAll <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs/operators'</span>

<span class="token keyword">import</span> log <span class="token keyword">from</span> <span class="token string">'./statusLog'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> downloadOptions<span class="token punctuation">,</span> defaultOptions<span class="token punctuation">,</span> Crawl<span class="token punctuation">,</span> Chatper <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./crawl'</span>
</code></pre></div><ul><li>å®šä¹‰ä¸€äº›åˆå§‹å‡½æ•°</li></ul> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// è¯·æ±‚</span>
<span class="token keyword">const</span> <span class="token function-variable function">request</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">from</span><span class="token punctuation">(</span><span class="token function">promisified</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// promise åŒ–</span>

<span class="token comment">// cheerio è½½å…¥</span>
<span class="token keyword">const</span> <span class="token function-variable function">toSelector</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">cheerio</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">throwError</span><span class="token punctuation">(</span><span class="token string">'æ²¡æœ‰æŠ“å–åˆ°å†…å®¹'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¤„ç† 301ã€302</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleFollowRedirect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">:</span> ServerRequest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> res
  <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span>headers<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token comment">// 301 æ˜¯ location è·³è½¬</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// å†æ¬¡é€šè¿‡ rxjs å®ä¾‹åŒ…è£¹</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>from</code> ä¼šæŠŠ <code>event</code> äº‹ä»¶ã€<code>Promise</code> ã€æ•°ç»„è½¬æ¢æˆ Rxjs çš„ <code>Observable</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Rxjs çš„æ“ä½œç¬¦äº†ï¼Œå¯¹äº Observable å¯ä»¥ç†è§£ä¸º <code>Promise</code> å¤šæ¬¡è§¦å‘ç‰ˆæœ¬ï¼Œæˆ–è€…æ•°ç»„ï¼Œäº¦æˆ–è€… <code>stream</code>ï¼Œä¸”ç”¨ <code>subscribe</code> ä»£æ›¿äº† <code>then</code> ã€‚<code>of</code> å…¶å®å°±æ˜¯ç±»ä¼¼ä¸æ•°ç»„çš„ <code>Array.of</code> è¡¨ç¤ºç”¨ Observable åŒ…è£¹ä¸€ä¸‹è¿™ä¸ªå˜é‡ã€‚</p> <p>å¯¹äº headers é‡Œé¢æœ‰ location çš„ï¼Œè¡¨ç¤ºæœ‰é‡å®šå‘ï¼Œå†æ¬¡è¯·æ±‚è¿™ä¸ªåœ°å€å³å¯ï¼Œä¸è¿‡ä¸ºäº†ç»Ÿä¸€ï¼Œéƒ½è¾“å‡º Observable çš„å®ä¾‹ï¼Œæ‰€æœ‰ç”¨ of åŒ…è£¹äº†ä¸€ä¸‹åŸæ¥çš„å“åº”æ•°æ®ã€‚</p> <p>åœ¨åé¢åŠ ä¸€ä¸ª <code>!</code> å¹å·è¡¨ç¤ºï¼Œå®ƒä¸€å®šä¸ä¸ºç©ºã€‚</p> <h2 id="æ„å»ºé€‰æ‹©å™¨"><a href="#æ„å»ºé€‰æ‹©å™¨" aria-hidden="true" class="header-anchor">#</a> æ„å»ºé€‰æ‹©å™¨</h2> <p>è¿™ä¸¤æ®µä»£ç å¯èƒ½æœ‰äº›å°éš¾ï¼Œå¯ä»¥å‚è€ƒæºç é‡Œé¢å®Œæˆçš„å†…å®¹è¿›è¡Œé˜…è¯»ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token comment">// è§£ç </span>
<span class="token keyword">const</span> decodeCharset <span class="token operator">=</span> <span class="token punctuation">(</span>charset<span class="token punctuation">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">:</span> Buffer</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">decode</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> charset<span class="token punctuation">)</span>

<span class="token comment">// è·å–é€‰æ‹©å™¨</span>
<span class="token keyword">const</span> <span class="token function-variable function">getSelector</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> charset<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">map</span><span class="token punctuation">(</span>handleFollowRedirect<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å¯¹ç»“æœå¤„ç† 301</span>
    <span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å‡å¦‚å¤„ç†äº† 301 , æ˜¯ 2 å±‚çš„ Observable å®ä¾‹ ï¼Œé“ºå¹³å®ƒ</span>
    <span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// æ‹¿åˆ° res.body</span>
    <span class="token function">map</span><span class="token punctuation">(</span><span class="token function">decodeCharset</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// è½¬ç </span>
    <span class="token function">map</span><span class="token punctuation">(</span>toSelector<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// æ„é€ é€‰æ‹©å™¨</span>
    <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ•è·é”™è¯¯</span>
      <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> err<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
</code></pre></div><p>é¦–å…ˆå¯¹è§£ç è¿›è¡ŒæŸ¯é‡ŒåŒ–ï¼Œ<code>map</code> å°±åƒæ•°ç»„ <code>[].map</code> å¯¹æ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œè¿™ä¸è¿‡æˆ‘ä»¬è¿™é‡Œé¢åªæœ‰ä¸€ä¸ªæ•°æ®ï¼Œå³è¯·æ±‚ url çš„ç»“æœã€‚ä¸ºäº†å¤„ç†è·³è½¬ï¼Œæˆ‘ä»¬åˆå°†å®ƒçš„è¿”å›å€¼å˜æˆäº† <code>Observable</code> çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´éœ€è¦ <code>subscribe</code> æ‰èƒ½æ‹¿åˆ°é‡Œé¢çš„ç»“æœã€‚ä»–å°±åƒä¸€ä¸ªé«˜é˜¶çš„ <code>Observable</code> ï¼Œ<code>Observable</code> é‡Œé¢è¿˜æœ‰ä¸€ä¸ª <code>Observable</code> ï¼Œä½¿ç”¨ <a href="https://rxjs-cn.github.io/learn-rxjs-operators/operators/combination/concatall.html" target="_blank" rel="noopener noreferrer">concatAll<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> å¯ä»¥æŠŠå®ƒè§£å‡ºæ¥ï¼Œå¹¶è¿æ¥èµ·æ¥ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å“åº”çš„ç»“æœï¼Œé€šè¿‡ <code>pluck('body')</code> æ‹¿åˆ° <code>body</code> å±æ€§ï¼Œç„¶åè§£ç ï¼Œè£…è½½ <code>cherrio</code> ï¼Œæœ€åæœ‰ä¸€ä¸ªæ•è·é”™è¯¯çš„å›è°ƒï¼Œæ•è·é”™è¯¯çš„å›è°ƒè¿˜æ˜¯è¦æœ‰è¿”å›ä¸€ä¸ª Observable çš„ã€‚</p> <h2 id="ä¸‹è½½ç« èŠ‚"><a href="#ä¸‹è½½ç« èŠ‚" aria-hidden="true" class="header-anchor">#</a> ä¸‹è½½ç« èŠ‚</h2> <p> æ‰§è¡Œä¸‹è½½ç« èŠ‚é€»è¾‘ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ log æŠŠæ¶ˆæ¯å‘é€åˆ°æ¸²æŸ“è¿›ç¨‹ï¼Œè¿™æ ·å°±å¯ä»¥æ˜¾ç¤ºç™¾åˆ†æ¯”ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadChapter</span><span class="token punctuation">(</span>
  <span class="token parameter">url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  crawl<span class="token punctuation">:</span> Crawl<span class="token punctuation">,</span>
  opts<span class="token punctuation">:</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> charset <span class="token punctuation">}</span> <span class="token operator">=</span> opts
  <span class="token keyword">const</span> selector <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> charset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> chatpers <span class="token operator">=</span> crawl<span class="token punctuation">.</span><span class="token function">chapter</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> url<span class="token punctuation">)</span>
  <span class="token keyword">const</span> savePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`chapters.json`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">writeJSON</span><span class="token punctuation">(</span>savePath<span class="token punctuation">,</span> chatpers<span class="token punctuation">)</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Required&lt;T&gt;</code> å¯ä»¥å°†å±æ€§éƒ½å˜æˆå¿…é¡»å­˜åœ¨çš„ã€‚<code>toPromise()</code> å¯ä»¥å°† <code>Observable</code> è½¬æ¢ä¸º <code>Promise</code> å¯¹è±¡å¤„ç†ã€‚</p> <p>å…¶å®ä¹Ÿå¯ä»¥ç”¨ Rxjs æ¥æ”¹é€ ä¸€ä¸‹</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadChapter</span><span class="token punctuation">(</span>
  <span class="token parameter">url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  crawl<span class="token punctuation">:</span> Crawl<span class="token punctuation">,</span>
  opts<span class="token punctuation">:</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> charset <span class="token punctuation">}</span> <span class="token operator">=</span> opts
  <span class="token keyword">const</span> savePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`chapters.json`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> charset<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// tap è¡¨ç¤ºå¤„ç†çš„æ—¶å€™é¡ºå¸¦æ‰§è¡Œä»¥ä¸‹è¿™é‡Œé¢çš„å†…å®¹ï¼Œä½†æ˜¯ä¸ä¿®æ”¹åŸæ¥çš„æ•°æ®</span>
      <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">$</span> <span class="token operator">=&gt;</span> crawl<span class="token punctuation">.</span><span class="token function">chapter</span><span class="token punctuation">(</span>$<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">chatpers</span> <span class="token operator">=&gt;</span> <span class="token function">writeJSON</span><span class="token punctuation">(</span>savePath<span class="token punctuation">,</span> chatpers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'chapter'</span><span class="token punctuation">,</span> percent<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">catchError</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> err<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">of</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>tap æ˜¯æŒ‰ç…§åŸæ ·è¾“å‡ºï¼Œå°±åƒ 1 ä¹˜ä»¥ä»»ä½•æ•°éƒ½ç­‰äºå®ƒåŸæ¥çš„æ•°ï¼Œåªä¸è¿‡æ‰§è¡Œä¸€ä¸‹é‡Œé¢çš„æ–¹æ³•è€Œå·²ã€‚</p> <h2 id="ä¸‹è½½å•ä¸ªå†…å®¹"><a href="#ä¸‹è½½å•ä¸ªå†…å®¹" aria-hidden="true" class="header-anchor">#</a> ä¸‹è½½å•ä¸ªå†…å®¹</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadText</span><span class="token punctuation">(</span>
  <span class="token parameter">chapter<span class="token punctuation">:</span> Chatper<span class="token punctuation">,</span>
  crawl<span class="token punctuation">:</span> Crawl<span class="token punctuation">,</span>
  index<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
  opts<span class="token punctuation">:</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> charset <span class="token punctuation">}</span> <span class="token operator">=</span> opts
  <span class="token keyword">const</span> savePath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`text/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chapter<span class="token punctuation">.</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.json`</span></span><span class="token punctuation">)</span> <span class="token comment">// å­˜å‚¨è·¯å¾„</span>
  <span class="token keyword">const</span> selector <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>chapter<span class="token punctuation">.</span>url<span class="token punctuation">,</span> charset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// $ é€‰æ‹©å™¨</span>
  <span class="token keyword">const</span> text <span class="token operator">=</span> crawl<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">writeJSON</span><span class="token punctuation">(</span>savePath<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="å¹¶å‘æ§åˆ¶ä¸‹è½½æ‰€æœ‰å†…å®¹"><a href="#å¹¶å‘æ§åˆ¶ä¸‹è½½æ‰€æœ‰å†…å®¹" aria-hidden="true" class="header-anchor">#</a> å¹¶å‘æ§åˆ¶ä¸‹è½½æ‰€æœ‰å†…å®¹</h2> <p>è¿™æ¬¡æˆ‘ä»¬æ¢ä¸€ç§æ–¹å¼æ¥å®ç°ï¼Œå…ˆåˆ†å‰²æ•°ç»„ï¼Œç„¶åé€šè¿‡é—­åŒ…æ„å»ºä¸€ä¸ªæ‡’å‡½æ•°ï¼Œåœ¨ä¸‹è½½çš„æ—¶å€™å†è·å– Promise æ•°ç»„ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">chunk</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> chunkSize<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token keyword">let</span> retArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;=</span> array<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    retArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> chunkSize<span class="token punctuation">)</span><span class="token punctuation">)</span>
    index <span class="token operator">+=</span> chunkSize
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> retArr
<span class="token punctuation">}</span>
</code></pre></div><p>chunk æœ€ä¸»è¦ç”¨æ¥åˆ†å‰²ï¼Œåˆ†å‰²æˆäºŒç»´æ•°ç»„ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token function-variable function">invoke</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">:</span> <span class="token builtin">Function</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨ä¼ é€’è¿›æ¥çš„å‡½æ•°</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadAllText</span><span class="token punctuation">(</span><span class="token parameter">crawl<span class="token punctuation">:</span> Crawl<span class="token punctuation">,</span> opts<span class="token punctuation">:</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> path<span class="token punctuation">,</span> concurrence<span class="token punctuation">,</span> waitTime <span class="token punctuation">}</span> <span class="token operator">=</span> opts
  <span class="token keyword">const</span> chaptersPath <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">'chapters.json'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> chapters <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readJson</span><span class="token punctuation">(</span>chaptersPath<span class="token punctuation">)</span>

  <span class="token keyword">const</span> needInvoke <span class="token operator">=</span> chapters<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chapter<span class="token punctuation">:</span> Chatper<span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token builtin">number</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token function">downloadText</span><span class="token punctuation">(</span>chapter<span class="token punctuation">,</span> crawl<span class="token punctuation">,</span> i<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token comment">// éœ€è¦è¢«è§¦å‘çš„å‡½æ•°æ•°ç»„</span>

  <span class="token keyword">let</span> chaptersChunk <span class="token operator">=</span> <span class="token function">chunk</span><span class="token punctuation">(</span>needInvoke<span class="token punctuation">,</span> concurrence<span class="token punctuation">)</span> <span class="token comment">// åˆ†å‰²</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> chaptersChunk<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> promies<span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> chaptersChunk<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>invoke<span class="token punctuation">)</span> <span class="token comment">// æ„å»º promise æ•°ç»„</span>
    <span class="token keyword">await</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promies<span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨</span>
    <span class="token keyword">const</span> percent <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">/</span> chaptersChunk<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> first <span class="token operator">=</span>
      index <span class="token operator">*</span> concurrence <span class="token operator">&lt;=</span> chapters<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token operator">?</span> index <span class="token operator">*</span> concurrence
        <span class="token punctuation">:</span> chapters<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// å½“å‰å—ç¬¬ä¸€ä¸ªåºå·çš„ç´¢å¼•</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span>
      step<span class="token punctuation">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
      percent<span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> chapters<span class="token punctuation">[</span>first<span class="token punctuation">]</span><span class="token punctuation">.</span>title
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    waitTime <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">timer</span><span class="token punctuation">(</span>waitTime<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>timer å¯ä»¥ç”¨æ¥æš‚åœæ‰§è¡Œï¼Œç­‰å¾…ä¸€å°ä¼šï¼Œå¤ªå¿«äº†å®¹æ˜“æŠ¥é”™ã€‚ä¸ºäº†å–åˆ°æ–‡ç« çš„æ ‡é¢˜ï¼Œéœ€è¦è®¡ç®—ä¸€ä¸‹åºå· <code>first</code></p> <h2 id="å¯¼å‡ºå‡½æ•°"><a href="#å¯¼å‡ºå‡½æ•°" aria-hidden="true" class="header-anchor">#</a> å¯¼å‡ºå‡½æ•°</h2> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> crawl<span class="token punctuation">:</span> Crawl<span class="token punctuation">,</span> opts<span class="token punctuation">:</span> downloadOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  opts <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> defaultOptions<span class="token punctuation">,</span> crawl<span class="token punctuation">.</span>opts<span class="token punctuation">,</span> opts<span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">ensureDir</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>opts<span class="token punctuation">.</span>path<span class="token operator">!</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ç¡®ä¿æ–‡ä»¶å­˜åœ¨</span>
    <span class="token keyword">await</span> <span class="token function">downloadChapter</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> crawl<span class="token punctuation">,</span> opts <span class="token keyword">as</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token comment">// ä¸‹è½½ç« èŠ‚</span>
    <span class="token keyword">await</span> <span class="token function">downloadAllText</span><span class="token punctuation">(</span>crawl<span class="token punctuation">,</span> opts <span class="token keyword">as</span> Required<span class="token operator">&lt;</span>downloadOptions<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token comment">// ä¸‹è½½å†…å®¹</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token keyword">type</span><span class="token punctuation">:</span> <span class="token string">'crawl'</span><span class="token punctuation">,</span> step<span class="token punctuation">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> e<span class="token punctuation">.</span>message <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> download
</code></pre></div><p>å°†å‡½æ•°å¯¼å‡ºä¾› index.ts ä½¿ç”¨</p> <h2 id="æµ‹è¯•åŠŸèƒ½"><a href="#æµ‹è¯•åŠŸèƒ½" aria-hidden="true" class="header-anchor">#</a> æµ‹è¯•åŠŸèƒ½</h2> <p>ä¿®æ”¹ <code>index.ts</code> , <code>test.js</code> æ˜¯è·Ÿä¸Šä¸€èŠ‚çš„ç±»ä¼¼ï¼Œä¸è¿‡å»æ‰äº† <code>require</code> ï¼Œå¯¼å‡ºçš„å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> app<span class="token punctuation">,</span> BrowserWindow<span class="token punctuation">,</span> ipcMain <span class="token keyword">as</span> ipc <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'electron'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fromEvent<span class="token punctuation">,</span> Subject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rxjs'</span>
<span class="token keyword">import</span> download <span class="token keyword">from</span> <span class="token string">'./download'</span>

<span class="token keyword">interface</span> <span class="token class-name">CombineEvent</span> <span class="token punctuation">{</span>
  <span class="token comment">// å°†åŸæ¥çš„ä¸¤ä¸ªå‚æ•°è½¬æˆå¯¹è±¡çš„æ¥å£</span>
  event<span class="token punctuation">:</span> <span class="token builtin">any</span>
  args<span class="token punctuation">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">channel<span class="token punctuation">:</span> <span class="token builtin">string</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span> Subject<span class="token operator">&lt;</span>CombineEvent<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> eventListner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token operator">&lt;</span>CombineEvent<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// é€šè¿‡ next å¯ä»¥æ´¾å‘æ—¶é—´çš„è®¢é˜…è€…æ¨¡å¼ï¼Œé‡Œé¢æ¯æ¬¡æ´¾å‘çš„å†…å®¹éƒ½æ˜¯ CombineEvent</span>
  ipc<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> args<span class="token punctuation">:</span> <span class="token builtin">any</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> eventListner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">{</span> event<span class="token punctuation">,</span> args <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> eventListner
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  mainWindow <span class="token operator">=</span> <span class="token function">createMainWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºä¸»çª—å£</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> event<span class="token punctuation">,</span> args <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ¥å—åˆ°ä¸‹è½½äº‹ä»¶çš„æ—¶å€™</span>
    <span class="token keyword">const</span> crawl <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./test.js'</span><span class="token punctuation">)</span> <span class="token comment">// å‘½ä»¤è¡Œç‰ˆæœ¬çš„æºæ–‡ä»¶</span>
    <span class="token function">download</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>url<span class="token punctuation">,</span> crawl<span class="token punctuation">,</span> <span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'./'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token builtin">console</span><span class="token punctuation">.</span>log<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ–°å»º <code>renderer/Status.svelte</code>ï¼Œ æˆ‘ä»¬åœ¨è¿™ä¸ªé‡Œé¢å‘é€ä¸‹è½½äº‹ä»¶ï¼Œåˆ°ä¸»è¿›ç¨‹é‡Œé¢</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{JSON.stringify(status)}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{JSON.stringify(errors)}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>download()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>xiazai<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> <span class="token punctuation">{</span>
        ipcRenderer
    <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;electron&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">{</span>
                status<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// å½“å‰çŠ¶æ€</span>
                errors<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// å­˜å‚¨é”™è¯¯</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">oncreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// åˆ›å»ºçš„æ—¶å€™è°ƒç”¨çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span>
            ipcRenderer<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;download-status&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// æ¥å—ä¸‹è½½çŠ¶æ€</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>step <span class="token operator">==</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">const</span> <span class="token punctuation">{</span>
                        errors
                    <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// get è·å– data ï¼Œset è®¾ç½® data</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        errors
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    status<span class="token punctuation">:</span> args
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;download&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ipcRenderer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;download&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// å‘é€ä¸‹è½½ä¿¡å·ï¼Œä¸ä¸‹è½½çš„åœ°å€</span>
                    url<span class="token punctuation">:</span> <span class="token string">&quot;https://www.ybdu.com/xiaoshuo/0/910&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>ä¿®æ”¹ <code>App.svelte</code>ï¼Œè½½å…¥è¿™ä¸ªåˆšåˆšå†™å¥½çš„ç»„ä»¶ã€‚</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Hello {name}!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Status</span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">h1</span> <span class="token punctuation">{</span>
        <span class="token property">color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> Status <span class="token keyword">from</span> <span class="token string">&quot;./Status.svelte&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
        components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            Status
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/electron-flyer/assets/img/download.4fd724a9.gif" alt="download"></p></div> <div class="content__footer-container"><div class="content__footer"><!----> <!----></div></div></div></div></div></div></div>
    <script src="/electron-flyer/assets/js/app.321478e2.js" defer></script><script src="/electron-flyer/assets/js/15.4888b394.js" defer></script>
  </body>
</html>
