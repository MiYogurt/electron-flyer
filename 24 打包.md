è¿™ä¸€å°èŠ‚çš„  å‘æ¯”è¾ƒå¤šï¼Œä»£ç æˆ‘ä¼šä¸Šä¼ åˆ° [Github](https://github.com/MiYogurt/electron-svelte-template/tree/package)

## ä¿®æ”¹æ‰“åŒ…è„šæœ¬

ä¿®æ”¹ `package.json` , é€šè¿‡åç½®é’©å­ï¼Œå¤åˆ¶å°å›¾æ ‡ã€‚æ²¡æœ‰å°å›¾æ ‡æ‰“åŒ…åçš„åº”ç”¨ä¼šæ‰“ä¸å¼€ï¼Œå¾ˆéš¾ä»¥å‘ç°è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“å¦‚ä½•è°ƒè¯•ï¼Œåé¢å†è¯´ã€‚

```json
"compile": "NODE_ENV=production electron-webpack",
"postcompile": "cp ./src/main/tray_w24h24.png ./dist/main",
```

## æ·»åŠ æ‰“åŒ…é…ç½®

ä¿®æ”¹ `package.json` ï¼Œæ·»åŠ ä¸€ä¸‹é…ç½®ï¼Œå®ƒæ¥è‡ªäº [electron-build](https://www.electron.build/configuration/mac/) å…¶å®åŸºæœ¬ä¸Šæ²¡æœ‰å¤šå°‘éœ€è¦é…ç½®çš„ï¼Œåªéœ€è¦é…ç½®ä¸ªæ‰“åŒ…çš„å›¾æ ‡å³å¯ã€‚ `music.icns` æ˜¯ä½¿ç”¨ `svg` æ–‡ä»¶ï¼ˆä¸ºäº†ä¿è¯é«˜ç²¾åº¦ï¼‰è½¬æ¢æ¥çš„ï¼Œä½¿ç”¨çš„æ˜¯ image2icon ã€‚

```json
"name": "reader",
"version": "0.0.1",
"build": {
    "appId": "me.yugo",
    "mac": {
        "category": "me.yugo",
        "icon": "./music.icns"
    }
},
```

`npm run dist` æœ€ç»ˆç”Ÿæˆåœ¨ dist çš„ yml é…ç½®æ–‡ä»¶ä¼šåƒè¿™æ ·

```yml
directories:
  output: dist
  buildResources: build
extraMetadata:
  main: main.js
files:
  - from: .
    filter:
      - package.json
  - from: dist/main
  - from: dist/renderer
  - from: dist/renderer-dll
extraResources:
  - from: static
    to: static
appId: me.yugo
mac:
  category: me.yugo
  icon: ./music.icns
extends: electron-webpack/electron-builder.yml
electronVersion: 2.0.4
```

## å°† dock çš„å›¾æ ‡éšè—

åœ¨ `ready` é‡Œé¢è°ƒç”¨

```
app.dock.hide()
```

## åˆ¤æ–­ç”Ÿäº§ç¯å¢ƒ

åœ¨ createMainWindow ä¸­ï¼Œè¿™é‡Œæˆ‘  æ¢äº†ä¸€ç§èŒƒå¼ã€‚

```js
import { format as formatUrl } from 'url'

if (process.env.NODE_ENV != 'production') {
  win.webContents.openDevTools()
  win.loadURL(`http://localhost:${process.env.ELECTRON_WEBPACK_WDS_PORT}`)
} else {
  win.loadURL(
    formatUrl({
      pathname: join(__dirname, 'index.html'),
      protocol: 'file',
      slashes: true
    })
  )
}
```

## ä¿®å¤ Music.svelte å›¾æ ‡

å›¾æ ‡æ˜¾ç¤ºä¼šæœ‰å¼‚å¸¸æˆ‘ä»¬ä¿®å¤ä¸€ä¸‹ã€‚

```js
function getStaticPath() {
  const isDevelopment = process.env.NODE_ENV === 'development'
  const staticPath = isDevelopment
    ? ''
    : 'file://' + __dirname.replace(/app\.asar$/, 'static')
  return staticPath
}
```

æ·»åŠ åˆ° data é‡Œé¢å»ã€‚

```js
data() {
    return {
        files: [],
        title: '',
        staticPath: getStaticPath() + '/'
    };
},
```

æ‹¼æ¥ url

```html
<div class="flex">
    <button on:click="file()"><img src="{staticPath + "plus-circle.png"}" width="25" height="25" alt="add"></button>
    <button on:click="play()"><img src="{staticPath + "play-circle.png"}" width="25" height="25" alt="play"></button>
    <button on:click="pause()"><img src="{staticPath + "time-out.png"}" width="25" height="25" alt="stop"></button>
    <button on:click="prev()"><img src="{staticPath + "left-circle.png"}" width="25" height="25" alt="prev"></button>
    <button on:click="next()"><img src="{staticPath + "right-circle.png"}" width="25" height="25" alt="next"></button>
</div>
```

## å…³äºè·¯å¾„

æœ€ç»ˆæ‰“åŒ…å¥½çš„è·¯å¾„ä¼šåƒä¸‹å›¾æ‰€ç¤ºï¼Œå¹¶éå¦‚ compile ä¹‹åçš„ `dist` ç›®å½•æ‰€ç¤ºï¼Œè¿™æ˜¯é¢å¤–è¦æ³¨æ„çš„ã€‚

![](./img/path1.png)

![](./img/path2.png)

## æ‰“åŒ…è°ƒè¯•

> å¦‚ä½•è§£å‹ asar æ–‡ä»¶

```bash
npm install -g asar
asar e app.asar app
```

> å¦‚ä½•è°ƒè¯•

è¿›å…¥åˆ°è§£å‹åçš„ app

```
npx electron ./main.js
```

è¿™æ ·å½“æœ‰é”™è¯¯çš„æ—¶å€™ï¼Œä¼šåœ¨ç»ˆç«¯æŠ¥å‡ºã€‚

## å¼€å§‹æ‰“åŒ…

```
npm run dist:dir
```

## å…³äºæ›´æ–°çš„è¯´æ˜

 å¯¹äºæ‰“åŒ…ï¼Œå…¶å®æˆ‘æœ‰å½•åˆ¶è¿‡éå¸¸è¯¦ç»†çš„è¯¾ç¨‹åœ¨æˆ‘çš„ä¸ªäººç½‘ç«™å¯ä»¥å¯»åˆ°ï¼Œä¹‹æ‰€ä»¥ä¸è®²çš„å¾ˆç»†æ˜¯å› ä¸º  å¤§å¤šæ•°äººæ›´å¸Œæœ›çŸ¥é“å¦‚ä½•å¿«é€Ÿåƒåˆ°èƒèŸ¹ï¼Œè€Œä¸æ˜¯çƒ¹é¥ªèƒèŸ¹ ğŸ¦€ ã€‚

æ›´æ–°åœ¨ `mac os` éœ€è¦è‹¹æœå¼€å‘è€…è®¤è¯è¯ä¹¦ç­¾åï¼Œæ‰€ä»¥ä½ éœ€è¦ä»˜è´¹ï¼Œåœ¨ windows ä¸‹é¢å¯ä»¥ä¸ç”¨ç­¾åã€‚æ›´æ–°ä¼šç”¨åˆ°ä¸€ä¸ª `latest-xxx.yml` çš„æ–‡ä»¶ï¼Œå®ƒåœ¨ dist ç›®å½•ä¸‹ï¼Œæ›´æ–°ä¼šæ‹‰å–è¿™ä¸ªæ–‡ä»¶åˆ¤æ–­ç‰ˆæœ¬å¹¶è¿›è¡Œæ›´æ–°ï¼Œæ›´æ–°ç›¸å…³ APIï¼ŒElectron å†…ç½®ã€‚æ›´æ–°é€šå¸¸éœ€è¦ä¸€ä¸ªæ›´æ–°æœåŠ¡å™¨ï¼Œéƒ¨ç½²åœ¨äº‘ç«¯ã€‚

## å‘å¸ƒåˆ° Github

ç‚¹å‡» release æŒ‰é’®ï¼Œä¸Šä¼ å³å¯ã€‚

![](./img/release.png)
